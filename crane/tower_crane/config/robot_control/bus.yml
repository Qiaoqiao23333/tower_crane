options: # General options especially dcf_path
  dcf_path: "@BUS_CONFIG_PATH@"

master: # The configuration of the master
  node_id: 127
  name: "master"
  driver: "ros2_canopen::MasterDriver"
  package: "canopen_master_driver"
  baudrate: 500  # CAN bus baudrate in kbit/s
  sync_period: 20000  # Communication Cycle Period (0x1006) = 0x00004E20
  boot_timeout: 5000

defaults: # Defaults that apply to all slave nodes
  dcf: "DSY-C.EDS"
  driver: "ros2_canopen::Cia402Driver"
  package: "canopen_402_driver"
  # period: 10
  # heartbeat_producer: 1000
  # heartbeat_consumer: 2000
  sdo_timeout_ms: 5000  # Increased timeout for reliable communication
  scale_pos_to_dev: 10000.000000
  scale_pos_from_dev: 0.0001
  position_mode: 1
  boot: true
  mandatory: true
  vendor_id: 0x100
  product_code: 0x0003
  revision_number: 0
  polling: true
  boot_timeout_ms: 15000  # Increased boot timeout for slow motors important !!!!!!!!
  # switching_state: 2  # Switch to Operation_Enable (state 5) before enabling - safer transition
  # state_switch_timeout: 20  # Increased timeout to 20 seconds for reliable state transitions
  sdo:    # Set Profile Position mode before enabling operation
    - {index: 0x6060, sub_index: 0, value: 1}
    - {index: 0x6081, sub_index: 0, value: 50000}  # Profile velocity
    - {index: 0x6083, sub_index: 0, value: 10000}  # Profile acceleration
    - {index: 0x6084, sub_index: 0, value: 10000}  # Profile deceleration
    - {index: 0x1006, sub_index: 0, value: 10000}
    # 设置插补时间周期 (60C2:01) 为 10 (单位由 sub_index 2 决定，通常为 ms) [cite: 11]
    - {index: 0x60C2, sub_index: 1, value: 10}
    # 设置插补时间指数 (60C2:02) 为 -3 (即 10^-3秒 = ms) [cite: 11]
    - {index: 0x60C2, sub_index: 2, value: -3}
    # - {index: 0x605A, sub_index: 0, value: 2}      # Quick stop deceleration
  tpdo:
    1:
      enabled: true
      cob_id: "auto"
      transmission: 0xFF  # ASynchronous
      mapping:
        - {index: 0x6041, sub_index: 0}  # Statusword (16 bits)
        - {index: 0x6064, sub_index: 0}  # Position actual value (32 bits)
    2:
      enabled: true
      cob_id: "auto"
      transmission: 0xFF
      mapping:
        - {index: 0x6061, sub_index: 0}  # Modes of operation display (8 bits)
        - {index: 0x606C, sub_index: 0}  # Velocity actual value (32 bits)
  rpdo:
    1:
      enabled: true
      cob_id: "auto"
      transmission: 0xFF
      mapping:
        - {index: 0x6040, sub_index: 0}  # Controlword
    2:
      enabled: true
      cob_id: "auto"
      transmission: 0xFF
      mapping:
        - {index: 0x607A, sub_index: 0}  # Target position

nodes: # Configurations for all slave nodes
  hook_joint:
    node_id: 1
    gearbox_ratio: 20.0
    scale_pos_to_dev: 200000.000000  # 10000.0 * 20 (gearbox ratio)
    scale_pos_from_dev: 0.000005     # 0.0001 / 20 (gearbox ratio)
  trolley_joint:
    node_id: 2
  slewing_joint:
    node_id: 3
    gearbox_ratio: 10.0
    scale_pos_to_dev: 100000.000000  # 10000.0 * 10 (gearbox ratio)
    scale_pos_from_dev: 0.00001      # 0.0001 / 10 (gearbox ratio)

